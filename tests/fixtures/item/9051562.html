<html><head><meta name="referrer" content="origin"></meta><link rel="stylesheet" type="text/css" href="news.css?o5VFxVrGbflhiRux3vVp"></link><link rel="shortcut icon" href="favicon.ico"></link><script type="text/javascript">
function byId(id) {
  return document.getElementById(id);
}

function vote(node) {
  var v = node.id.split(/_/);   // {'up', '123'}
  var item = v[1];

  // hide arrows
  byId('up_'   + item).style.visibility = 'hidden';
  byId('down_' + item).style.visibility = 'hidden';

  // ping server
  var ping = new Image();
  ping.src = node.href;

  return false; // cancel browser nav
} </script><title>C# 6 exception filters and how they are more than syntactic sugar | Hacker News</title></head><body><center><table id="hnmain" op="item" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef"><tr><td bgcolor="#ff6600"><table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px"><tr><td style="width:18px;padding-right:4px"><a href="http://www.ycombinator.com"><img src="y18.gif" width="18" height="18" style="border:1px #ffffff solid;"></img></a></td><td style="line-height:12pt; height:10px;"><span class="pagetop"><b><a href="news">Hacker News</a></b><img src="s.gif" height="1" width="10"><a href="newest">new</a> | <a href="newcomments">comments</a> | <a href="show">show</a> | <a href="ask">ask</a> | <a href="jobs">jobs</a> | <a href="submit">submit</a></span></td><td style="text-align:right;padding-right:4px;"><span class="pagetop"><a href="login?goto=item%3Fid%3D9051562">login</a></span></td></tr></table></td></tr><tr style="height:10px"></tr><tr><td><table border="0"><tr><td><center><a id="up_9051562" href="vote?for=9051562&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051562"></span></center></td><td class="title"><span class="deadmark"></span><a href="http://volatileread.com/Wiki/Index?id=1087">C# 6 exception filters and how they are more than syntactic sugar</a><span class="sitebit comhead"> (volatileread.com)</span></td></tr><tr><td colspan="1"></td><td class="subtext"><span class="score" id="score_9051562">33 points</span> by <a href="user?id=bursurk">bursurk</a> <a href="item?id=9051562">7 hours ago</a>  | <a href="item?id=9051562">15 comments</a></td></tr><tr style="height:10px"></tr><tr><td></td><td><form method="post" action="comment"><input type="hidden" name="parent" value="9051562"><input type="hidden" name="goto" value="item?id=9051562"><input type="hidden" name="hmac" value="9a6b1ce2deca46cc1bccd7e425b94854fd420e6e"><textarea name="text" rows="6" cols="60" style="" placeholder=""></textarea><br><br>
<input type="submit" value="add comment"></form></td></tr></table><br><br>
<table border="0"><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9052110" href="vote?for=9052110&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052110"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=Locke1689">Locke1689</a> <a href="item?id=9052110">1 hour ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Short story about exception filters: they&#x27;re mostly there for crash dumps.<p>The background is that there is a piece of functionality in Windows previously called Watson, now called Windows Error Reporting. It&#x27;s that dialog that pops up when an application crashes that asks if you&#x27;d like to report the crash to Microsoft. If you do, it sends a crash dump to Microsoft, where it can then be routed to the owner of the application, even if the application isn&#x27;t actually developed by Microsoft.<p>So a lot of developers in the know have designed their applications so that unrecoverable errors actually purposely cause the application to crash so that they can get a dump from WER. One of the standard ways of doing this is simply wrapping your code in a catch at the top level and then calling Environment.FailFast to crash the process.<p>The problem is that sometimes the stack is destroyed in this process. Note that I didn&#x27;t say the stack trace -- the <i>stack</i> is destroyed. You can see this if you catch and rethrow an exception. The locals from the original exception are gone, so now the dump is far more difficult to debug.<p>Exception filters let you get around this because they don&#x27;t actually pop anything, including the exception, from the stack, so if you FailFast, you crash with the full stack of the process.<p>A number of .NET developers had previously figured this out and were doing a bunch of nasty stuff to get this behavior, like including a VB net module with an exception filter fail-fast, or ildasm&#x2F;ilasming their assembly. We tried a bunch of these methods on the compiler and they were all a source of many really obnoxious bugs, so eventually another compiler developer and I just said &quot;screw it&quot; and implemented exception filters in C#. All the bugs went away and we lived happily ever after.<p>Oh, and now exception filters are in the language.</font></span><p><font size="1"><u><a href="reply?id=9052110&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9052135" href="vote?for=9052135&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052135"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=dfox">dfox</a> <a href="item?id=9052135">44 minutes ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Main purpose of this mechanism is ability to not catch some exceptions at all so that full state of memory (primarily stack itself) is preserved in crash dump or for inspection in attached debugger (which seems like more useful case to me).<p>With that purpose in mind, wrapping your application on the top level with try ... catch (Exception) {abort()} negates any benefit that you may get out of exception filters.</font></span><p><font size="1"><u><a href="reply?id=9052135&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9051715" href="vote?for=9051715&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051715"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=Pxtl">Pxtl</a> <a href="item?id=9051715">6 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">So basically, the CLR has ugly behavior on rethrows that can only be sanely described as a bug but it&#x27;s a common-law feature at this point so we&#x27;re using an ugly linguistic construct to work around it.</font></span><p><font size="1"><u><a href="reply?id=9051715&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9051735" href="vote?for=9051735&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051735"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=kangaroo">kangaroo</a> <a href="item?id=9051735">6 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">C# != CLR.  CLR has had exception filters for a very long time, if not forever.  The runtime != the language.</font></span><p><font size="1"><u><a href="reply?id=9051735&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9051875" href="vote?for=9051875&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051875"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=Lx1oG-AWb6h_ZG0">Lx1oG-AWb6h_ZG0</a> <a href="item?id=9051875">4 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">I&#x27;m confused, what is the alternative here? I expect the IDE to stop when an exception is not handled. Should it stop even if it is?</font></span><p><font size="1"><u><a href="reply?id=9051875&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="80"></td><td valign="top"><center><a id="up_9052102" href="vote?for=9052102&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052102"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=Someone">Someone</a> <a href="item?id=9052102">1 hour ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Separate exception catching from stack unwinding as in the Lisp condition system, where low-level code decides when to call high-level code and what options to present it, and the high-level code does whatever it wants to do and then picks an option.<p>That more or less gives you what Microsoft calls &#x27;edit and continue&#x27; in every program, where your high-level code decides what code does the edit and decides on how to continue.<p>Some discussion with real-world usage scenarios at <a href="http://lambda-the-ultimate.org/node/1544" rel="nofollow">http:&#x2F;&#x2F;lambda-the-ultimate.org&#x2F;node&#x2F;1544</a>. Example at <a href="http://c2.com/cgi/wiki?LispRestartExample" rel="nofollow">http:&#x2F;&#x2F;c2.com&#x2F;cgi&#x2F;wiki?LispRestartExample</a></font></span><p><font size="1"><u><a href="reply?id=9052102&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="80"></td><td valign="top"><center><a id="up_9052029" href="vote?for=9052029&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052029"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=MaulingMonkey">MaulingMonkey</a> <a href="item?id=9052029">2 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">There&#x27;s an option for that in Visual Studio.  It&#x27;s not enabled by default, but I&#x27;ve found it handy for situations like this.<p>The other alternative is what C# 6 added: eliminating the need to rethrow in as many circumstances in the first place, so &#x27;logically&#x27; unhandled exceptions can be actually unhandled.</font></span><p><font size="1"><u><a href="reply?id=9052029&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9052051" href="vote?for=9052051&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052051"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=RomanPushkin">RomanPushkin</a> <a href="item?id=9052051">2 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">catch if(Log())<p>Doesn&#x27;t look great. It&#x27;s not easy to understand what this code does. I&#x27;d better rewrite it this way:<p>catch if(IsExceptionLogged())<p>So we can see here &quot;Is&quot; keyword, it gives us a hint that this function returns boolean. We can see the main operation, and it&#x27;s more human-readable. And we can easily understand what do we mean here. Because in case of Log() we have to think - should we catch if it was logged or if it was not logged.<p>Maybe it is useful in some cases. But unfortunately the code quality doesn&#x27;t depend on the tools one uses, and it&#x27;s nothing about language features. 99% of developers don&#x27;t know how to use C# 1.0. There are so still a lot for them to learn.<p>Maybe even<p>catch if(IsExceptionHandled())<p>is better. Because I don&#x27;t see any reasons why should we catch exceptions if it was logged. Yep, it was logged - is it a good decision factor to catch? Logging often can be disabled in configuration.</font></span><p><font size="1"><u><a href="reply?id=9052051&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9052065" href="vote?for=9052065&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052065"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=RomanPushkin">RomanPushkin</a> <a href="item?id=9052065">1 hour ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">PS It&#x27;s also a bad idea to compare exception messages. Well, I know, it&#x27;s a sample, but just wanna point that it&#x27;s not the best one. First - exception messages could be internationalized. Second - general string comparison should be done with InvariantCulture, and case-ignorant (and usually strings are trimmed). And even in that case it&#x27;s not a good idea. It&#x27;s better to compare types, or message codes.</font></span><p><font size="1"><u><a href="reply?id=9052065&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9052007" href="vote?for=9052007&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052007"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=kazinator">kazinator</a> <a href="item?id=9052007">2 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Exception filters seem to be imitated from Win32 structured exception handling (SEH).<p>See &quot;Example 3&quot; here:<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681409%28v=vs.85%29.aspx" rel="nofollow">https:&#x2F;&#x2F;msdn.microsoft.com&#x2F;en-us&#x2F;library&#x2F;windows&#x2F;desktop&#x2F;ms6...</a><p>in particular, how FilterFunction is used.</font></span><p><font size="1"><u><a href="reply?id=9052007&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9052061" href="vote?for=9052061&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052061"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=junto">junto</a> <a href="item?id=9052061">1 hour ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Horrible looking magic strings there. Isn&#x27;t it better to just throw typed exceptions? Then you can catch(MyCustomException).</font></span><p><font size="1"><u><a href="reply?id=9052061&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9052086" href="vote?for=9052086&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9052086"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=zaroth">zaroth</a> <a href="item?id=9052086">1 hour ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">Often the only difference between encoding the type in a string, and encoding the type in a full-blown typed Exception is perhaps &#x27;Find All References&#x27;. Typing the Exception can be a waste of typing and unnecessary cruft. More &quot;structure&quot; is not always better.<p>If there&#x27;s some unique data which must be carried back up the stack with the Exception it&#x27;s a different story.</font></span><p><font size="1"><u><a href="reply?id=9052086&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="0"></td><td valign="top"><center><a id="up_9051775" href="vote?for=9051775&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051775"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=chadzawistowski">chadzawistowski</a> <a href="item?id=9051775">5 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#9c9c9c">In Python, you can simply type `raise` to re-raise the exception you caught, preserving the stack trace.</font></span><p><font size="1"><u><a href="reply?id=9051775&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9051803" href="vote?for=9051803&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051803"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=ufmace">ufmace</a> <a href="item?id=9051803">5 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">In C#, throw also re-throws and preserves the stack trace in the exception object. What the article points out that it doesn&#x27;t do is preserve the full call stack and method state in the Visual Studio debugger, and that only if you explicitly turn off break on throw, leaving it in break on throwing uncaught exceptions instead.<p>In fact, changing state in an exception filter method that always returns false sounds terrible to me. What if you actually need to do something with that exception, or to clean up state? What if the Log method does something wrong that you need to debug? Exception filters are handy, but I hope to never see them used like that.<p>Now the new null propagation operator, on the other hand, get me some of that, and I hope to see it used everywhere.</font></span><p><font size="1"><u><a href="reply?id=9051803&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr><tr><td><table border="0"><tr><td><img src="s.gif" height="1" width="40"></td><td valign="top"><center><a id="up_9051792" href="vote?for=9051792&amp;dir=up&amp;goto=item%3Fid%3D9051562"><div class="votearrow" title="upvote"></div></a><span id="down_9051792"></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=tacos">tacos</a> <a href="item?id=9051792">5 hours ago</a> <span class="deadmark"></span></span></div><br>
<span class="comment"><font color="#000000">In C# the equivalent is &quot;throw;&quot;<p>And that&#x27;s not what this article is about.</font></span><p><font size="1"><u><a href="reply?id=9051792&amp;goto=item%3Fid%3D9051562">reply</a></u></font></td></tr></table></td></tr></table><br><br>
</td></tr><tr><td><img src="s.gif" height="10" width="0"><table width="100%" cellspacing="0" cellpadding="1"><tr><td bgcolor="#ff6600"></td></tr></table><br>
<center><span class="yclinks"><a href="newsguidelines.html">Guidelines</a> | <a href="newsfaq.html">FAQ</a> | <a href="mailto:hn@ycombinator.com">Support</a> | <a href="lists">Lists</a> | <a href="bookmarklet.html">Bookmarklet</a> | <a href="dmca.html">DMCA</a> | <a href="http://www.ycombinator.com/">Y Combinator</a> | <a href="http://www.ycombinator.com/apply/">Apply</a> | <a href="mailto:hn@ycombinator.com">Contact</a></span><br><br>
<form method="get" action="//hn.algolia.com/">Search: <input type="text" name="q" value="" size="17"></form></center></td></tr></table></center></body></html>